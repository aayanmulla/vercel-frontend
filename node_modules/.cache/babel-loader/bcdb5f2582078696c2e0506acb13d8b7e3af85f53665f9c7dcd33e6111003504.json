{"ast":null,"code":"import React,{useState}from\"react\";import{useNavigate}from\"react-router-dom\";import axios from\"axios\";import\"./Signup.css\";import API_ENDPOINTS from\"../../apiEndpoints\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Signup=()=>{const[formData,setFormData]=useState({username:\"\",email:\"\",password:\"\",retypepassword:\"\"});const[otp,setOtp]=useState(\"\");const[showOtpField,setShowOtpField]=useState(false);const[error,setError]=useState(\"\");// const [emailVerified, setEmailVerified] = useState(false);\nconst navigate=useNavigate();const handleChange=e=>{const{name,value}=e.target;setFormData({...formData,[name]:value});};const handleSubmit=async e=>{e.preventDefault();// ✅ Password validation regex\nconst passwordRegex=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/;// ✅ Check if password meets the criteria\nif(!passwordRegex.test(formData.password)){alert(\"Password must be at least 8 characters long, include an uppercase letter, a lowercase letter, a number, and a special character.\");return;}// ✅ Check if passwords match\nif(formData.password!==formData.retypepassword){alert(\"Passwords do not match!\");return;}try{// Send OTP to email\nconst response=await axios.post(API_ENDPOINTS.SIGNUP,{username:formData.username,email:formData.email,password:formData.password,retypepassword:formData.retypepassword});if(response.status===200){alert(\"OTP sent to your email. Please verify.\");setShowOtpField(true);// Show OTP input field\n}}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.msg)||\"Signup failed.\");}};const handleVerifyOtp=async()=>{try{const response=await axios.post(API_ENDPOINTS.VERIFY_OTP,{email:formData.email,otp:otp,username:formData.username,password:formData.password});if(response.status===201){alert(\"Email verified successfully! Account created.\");// ✅ Get the first letter of the username\nconst firstLetter=formData.username.charAt(0).toUpperCase();// ✅ Assign profile image\nconst profileImageUrl=response.data.user.profileImage||`https://ui-avatars.com/api/?name=${firstLetter}&background=random&color=fff&size=128`;// ✅ Ensure user data is set properly\n// ✅ Store user data in localStorage\nconst userData={username:response.data.user.username,profileImage:profileImageUrl// ✅ Assign generated/returned profile image\n};localStorage.setItem(\"user\",JSON.stringify(userData));localStorage.setItem(\"token\",response.data.token);// ✅ Check if data is stored correctly\nconsole.log(\"Stored User:\",localStorage.getItem(\"user\"));// ✅ Notify other components of change\nwindow.dispatchEvent(new Event(\"storage\"));navigate(\"/bookings\");// Redirect after successful signup\n}}catch(error){var _error$response2,_error$response2$data;setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.msg)||\"Invalid OTP. Try again.\");}};return/*#__PURE__*/_jsx(\"div\",{className:\"signup-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"signup-card\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"logo\",children:\"ParkEz\"}),/*#__PURE__*/_jsx(\"div\",{className:\"top-right-links\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"New User? \",/*#__PURE__*/_jsx(\"a\",{href:\"/login\",children:\"Login\"})]})}),/*#__PURE__*/_jsx(\"p\",{children:\"Register to continue\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"signup-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"username\",placeholder:\"Full Name\",value:formData.username,onChange:handleChange,required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",placeholder:\"Email Id\",value:formData.email,onChange:handleChange,required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"password\",placeholder:\"Enter Password\",value:formData.password,onChange:handleChange,required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"retypepassword\",placeholder:\"Confirm Password\",value:formData.retypepassword,onChange:handleChange,required:true})}),!showOtpField?/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"signup-button\",children:\"SIGN UP\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter OTP\",value:otp,onChange:e=>setOtp(e.target.value),required:true})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"signup-button\",onClick:handleVerifyOtp,children:\"Verify OTP\"})]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error-text\",children:error})]})]})});};export default Signup;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}